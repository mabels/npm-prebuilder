'use strict';

var _ava = require('ava');

var _ava2 = _interopRequireDefault(_ava);

var _resolveExtends = require('./resolve-extends');

var _resolveExtends2 = _interopRequireDefault(_resolveExtends);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var id = function id(_id) {
	return _id;
};

(0, _ava2.default)('returns empty object when called without params', function (t) {
	var actual = (0, _resolveExtends2.default)();
	t.deepEqual(actual, {});
});

(0, _ava2.default)('returns an equivalent object as passed in', function (t) {
	var expected = { foo: 'bar' };
	var actual = (0, _resolveExtends2.default)(expected);
	t.deepEqual(actual, expected);
});

(0, _ava2.default)('uses empty prefix by default', function (t) {
	var input = { extends: ['extender-name'] };

	(0, _resolveExtends2.default)(input, {
		resolve: id,
		require(id) {
			t.is(id, 'extender-name');
		}
	});
});

(0, _ava2.default)('uses prefix as configured', function (t) {
	var input = { extends: ['extender-name'] };

	(0, _resolveExtends2.default)(input, {
		prefix: 'prefix',
		resolve: id,
		require(id) {
			t.is(id, 'prefix-extender-name');
		}
	});
});

(0, _ava2.default)('ignores prefix for scoped extends', function (t) {
	var input = { extends: ['@scope/extender-name'] };

	(0, _resolveExtends2.default)(input, {
		prefix: 'prefix',
		resolve: id,
		require(id) {
			t.is(id, '@scope/extender-name');
		}
	});
});

(0, _ava2.default)('ignores prefix for relative extends', function (t) {
	var input = { extends: ['./extender'] };

	(0, _resolveExtends2.default)(input, {
		prefix: 'prefix',
		resolve: id,
		require(id) {
			t.is(id, './extender');
		}
	});
});

(0, _ava2.default)('propagates return value of require function', function (t) {
	var input = { extends: ['extender-name'] };
	var propagated = { foo: 'bar' };

	var actual = (0, _resolveExtends2.default)(input, {
		resolve: id,
		require() {
			return propagated;
		}
	});

	t.is(actual.foo, 'bar');
});

(0, _ava2.default)('resolves extends recursively', function (t) {
	var input = { extends: ['extender-name'] };
	var actual = [];

	(0, _resolveExtends2.default)(input, {
		resolve: id,
		require(id) {
			actual.push(id);
			if (id === 'extender-name') {
				return { extends: ['recursive-extender-name'] };
			}
			if (id === 'recursive-extender-name') {
				return { foo: 'bar' };
			}
		}
	});

	t.deepEqual(actual, ['extender-name', 'recursive-extender-name']);
});

(0, _ava2.default)('uses prefix key recursively', function (t) {
	var input = { extends: ['extender-name'] };
	var actual = [];

	(0, _resolveExtends2.default)(input, {
		prefix: 'prefix',
		resolve: id,
		require(id) {
			actual.push(id);
			if (id === 'prefix-extender-name') {
				return { extends: ['recursive-extender-name'] };
			}
			if (id === 'prefix-recursive-extender-name') {
				return { foo: 'bar' };
			}
		}
	});

	t.deepEqual(actual, ['prefix-extender-name', 'prefix-recursive-extender-name']);
});

(0, _ava2.default)('propagates contents recursively', function (t) {
	var input = { extends: ['extender-name'] };

	var actual = (0, _resolveExtends2.default)(input, {
		resolve: id,
		require(id) {
			if (id === 'extender-name') {
				return { extends: ['recursive-extender-name'], foo: 'bar' };
			}
			if (id === 'recursive-extender-name') {
				return { baz: 'bar' };
			}
		}
	});

	var expected = {
		extends: ['extender-name'],
		foo: 'bar',
		baz: 'bar'
	};

	t.deepEqual(actual, expected);
});

(0, _ava2.default)('extending contents should take precedence', function (t) {
	var input = { extends: ['extender-name'], zero: 'root' };

	var actual = (0, _resolveExtends2.default)(input, {
		resolve: id,
		require(id) {
			if (id === 'extender-name') {
				return { extends: ['recursive-extender-name'], zero: id, one: id };
			}
			if (id === 'recursive-extender-name') {
				return {
					extends: ['second-recursive-extender-name'],
					zero: id,
					one: id,
					two: id
				};
			}
			if (id === 'second-recursive-extender-name') {
				return { zero: id, one: id, two: id, three: id };
			}
		}
	});

	var expected = {
		extends: ['extender-name'],
		zero: 'root',
		one: 'extender-name',
		two: 'recursive-extender-name',
		three: 'second-recursive-extender-name'
	};

	t.deepEqual(actual, expected);
});

(0, _ava2.default)('should fall back to conventional-changelog-lint-config prefix', function (t) {
	var input = { extends: ['extender-name'] };

	var actual = (0, _resolveExtends2.default)(input, {
		prefix: 'prefix',
		resolve(id) {
			if (id === 'conventional-changelog-lint-config-extender-name') {
				return 'conventional-changelog-lint-config-extender-name';
			}
			throw new Error(`Could not find module "*${id}"`);
		},
		require(id) {
			if (id === 'conventional-changelog-lint-config-extender-name') {
				return {
					rules: {
						fallback: true
					}
				};
			}
		}
	});

	t.deepEqual(actual, {
		extends: ['extender-name'],
		rules: {
			fallback: true
		}
	});
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWJyYXJ5L3Jlc29sdmUtZXh0ZW5kcy50ZXN0LmpzIl0sIm5hbWVzIjpbImlkIiwiYWN0dWFsIiwidCIsImRlZXBFcXVhbCIsImV4cGVjdGVkIiwiZm9vIiwiaW5wdXQiLCJleHRlbmRzIiwicmVzb2x2ZSIsInJlcXVpcmUiLCJpcyIsInByZWZpeCIsInByb3BhZ2F0ZWQiLCJwdXNoIiwiYmF6IiwiemVybyIsIm9uZSIsInR3byIsInRocmVlIiwiRXJyb3IiLCJydWxlcyIsImZhbGxiYWNrIl0sIm1hcHBpbmdzIjoiOztBQUFBOzs7O0FBQ0E7Ozs7OztBQUVBLElBQU1BLEtBQUs7QUFBQSxRQUFNQSxHQUFOO0FBQUEsQ0FBWDs7QUFFQSxtQkFBSyxpREFBTCxFQUF3RCxhQUFLO0FBQzVELEtBQU1DLFNBQVMsK0JBQWY7QUFDQUMsR0FBRUMsU0FBRixDQUFZRixNQUFaLEVBQW9CLEVBQXBCO0FBQ0EsQ0FIRDs7QUFLQSxtQkFBSywyQ0FBTCxFQUFrRCxhQUFLO0FBQ3RELEtBQU1HLFdBQVcsRUFBQ0MsS0FBSyxLQUFOLEVBQWpCO0FBQ0EsS0FBTUosU0FBUyw4QkFBZUcsUUFBZixDQUFmO0FBQ0FGLEdBQUVDLFNBQUYsQ0FBWUYsTUFBWixFQUFvQkcsUUFBcEI7QUFDQSxDQUpEOztBQU1BLG1CQUFLLDhCQUFMLEVBQXFDLGFBQUs7QUFDekMsS0FBTUUsUUFBUSxFQUFDQyxTQUFTLENBQUMsZUFBRCxDQUFWLEVBQWQ7O0FBRUEsK0JBQWVELEtBQWYsRUFBc0I7QUFDckJFLFdBQVNSLEVBRFk7QUFFckJTLFVBQVFULEVBQVIsRUFBWTtBQUNYRSxLQUFFUSxFQUFGLENBQUtWLEVBQUwsRUFBUyxlQUFUO0FBQ0E7QUFKb0IsRUFBdEI7QUFNQSxDQVREOztBQVdBLG1CQUFLLDJCQUFMLEVBQWtDLGFBQUs7QUFDdEMsS0FBTU0sUUFBUSxFQUFDQyxTQUFTLENBQUMsZUFBRCxDQUFWLEVBQWQ7O0FBRUEsK0JBQWVELEtBQWYsRUFBc0I7QUFDckJL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RUFBNkJrQixPQUFPbEIsRUFBcEMsRUFBUDtBQUNBO0FBQ0Q7QUFqQm1DLEVBQXRCLENBQWY7O0FBb0JBLEtBQU1JLFdBQVc7QUFDaEJHLFdBQVMsQ0FBQyxlQUFELENBRE87QUFFaEJRLFFBQU0sTUFGVTtBQUdoQkMsT0FBSyxlQUhXO0FBSWhCQyxPQUFLLHlCQUpXO0FBS2hCQyxTQUFPO0FBTFMsRUFBakI7O0FBUUFoQixHQUFFQyxTQUFGLENBQVlGLE1BQVosRUFBb0JHLFFBQXBCO0FBQ0EsQ0FoQ0Q7O0FBa0NBLG1CQUFLLCtEQUFMLEVBQXNFLGFBQUs7QUFDMUUsS0FBTUUsUUFBUSxFQUFDQyxTQUFTLENBQUMsZUFBRCxDQUFWLEVBQWQ7O0FBRUEsS0FBTU4sU0FBUyw4QkFBZUssS0FBZixFQUFzQjtBQUNwQ0ssVUFBUSxRQUQ0QjtBQUVwQ0gsVUFBUVIsRUFBUixFQUFZO0FBQ1gsT0FBSUEsT0FBTyxrREFBWCxFQUErRDtBQUM5RCxXQUFPLGtEQUFQO0FBQ0E7QUFDRCxTQUFNLElBQUltQixLQUFKLENBQVcsMkJBQTBCbkIsRUFBRyxHQUF4QyxDQUFOO0FBQ0EsR0FQbUM7QUFRcENTLFVBQVFULEVBQVIsRUFBWTtBQUNYLE9BQUlBLE9BQU8sa0RBQVgsRUFBK0Q7QUFDOUQsV0FBTztBQUNOb0IsWUFBTztBQUNOQyxnQkFBVTtBQURKO0FBREQsS0FBUDtBQUtBO0FBQ0Q7QUFoQm1DLEVBQXRCLENBQWY7O0FBbUJBbkIsR0FBRUMsU0FBRixDQUFZRixNQUFaLEVBQW9CO0FBQ25CTSxXQUFTLENBQUMsZUFBRCxDQURVO0FBRW5CYSxTQUFPO0FBQ05DLGFBQVU7QUFESjtBQUZZLEVBQXBCO0FBTUEsQ0E1QkQiLCJmaWxlIjoicmVzb2x2ZS1leHRlbmRzLnRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdGVzdCBmcm9tICdhdmEnO1xuaW1wb3J0IHJlc29sdmVFeHRlbmRzIGZyb20gJy4vcmVzb2x2ZS1leHRlbmRzJztcblxuY29uc3QgaWQgPSBpZCA9PiBpZDtcblxudGVzdCgncmV0dXJucyBlbXB0eSBvYmplY3Qgd2hlbiBjYWxsZWQgd2l0aG91dCBwYXJhbXMnLCB0ID0+IHtcblx0Y29uc3QgYWN0dWFsID0gcmVzb2x2ZUV4dGVuZHMoKTtcblx0dC5kZWVwRXF1YWwoYWN0dWFsLCB7fSk7XG59KTtcblxudGVzdCgncmV0dXJucyBhbiBlcXVpdmFsZW50IG9iamVjdCBhcyBwYXNzZWQgaW4nLCB0ID0+IHtcblx0Y29uc3QgZXhwZWN0ZWQgPSB7Zm9vOiAnYmFyJ307XG5cdGNvbnN0IGFjdHVhbCA9IHJlc29sdmVFeHRlbmRzKGV4cGVjdGVkKTtcblx0dC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG59KTtcblxudGVzdCgndXNlcyBlbXB0eSBwcmVmaXggYnkgZGVmYXVsdCcsIHQgPT4ge1xuXHRjb25zdCBpbnB1dCA9IHtleHRlbmRzOiBbJ2V4dGVuZGVyLW5hbWUnXX07XG5cblx0cmVzb2x2ZUV4dGVuZHMoaW5wdXQsIHtcblx0XHRyZXNvbHZlOiBpZCxcblx0XHRyZXF1aXJlKGlkKSB7XG5cdFx0XHR0LmlzKGlkLCAnZXh0ZW5kZXItbmFtZScpO1xuXHRcdH1cblx0fSk7XG59KTtcblxudGVzdCgndXNlcyBwcmVmaXggYXMgY29uZmlndXJlZCcsIHQgPT4ge1xuXHRjb25zdCBpbnB1dCA9IHtleHRlbmRzOiBbJ2V4dGVuZGVyLW5hbWUnXX07XG5cblx0cmVzb2x2ZUV4dGVuZHMoaW5wdXQsIHtcblx0XHRwcmVmaXg6ICdwcmVmaXgnLFxuXHRcdHJlc29sdmU6IGlkLFxuXHRcdHJlcXVpcmUoaWQpIHtcblx0XHRcdHQuaXMoaWQsICdwcmVmaXgtZXh0ZW5kZXItbmFtZScpO1xuXHRcdH1cblx0fSk7XG59KTtcblxudGVzdCgnaWdub3JlcyBwcmVmaXggZm9yIHNjb3BlZCBleHRlbmRzJywgdCA9PiB7XG5cdGNvbnN0IGlucHV0ID0ge2V4dGVuZHM6IFsnQHNjb3BlL2V4dGVuZGVyLW5hbWUnXX07XG5cblx0cmVzb2x2ZUV4dGVuZHMoaW5wdXQsIHtcblx0XHRwcmVmaXg6ICdwcmVmaXgnLFxuXHRcdHJlc29sdmU6IGlkLFxuXHRcdHJlcXVpcmUoaWQpIHtcblx0XHRcdHQuaXMoaWQsICdAc2NvcGUvZXh0ZW5kZXItbmFtZScpO1xuXHRcdH1cblx0fSk7XG59KTtcblxudGVzdCgnaWdub3JlcyBwcmVmaXggZm9yIHJlbGF0aXZlIGV4dGVuZHMnLCB0ID0+IHtcblx0Y29uc3QgaW5wdXQgPSB7ZXh0ZW5kczogWycuL2V4dGVuZGVyJ119O1xuXG5cdHJlc29sdmVFeHRlbmRzKGlucHV0LCB7XG5cdFx0cHJlZml4OiAncHJlZml4Jyxcblx0XHRyZXNvbHZlOiBpZCxcblx0XHRyZXF1aXJlKGlkKSB7XG5cdFx0XHR0LmlzKGlkLCAnLi9leHRlbmRlcicpO1xuXHRcdH1cblx0fSk7XG59KTtcblxudGVzdCgncHJvcGFnYXRlcyByZXR1cm4gdmFsdWUgb2YgcmVxdWlyZSBmdW5jdGlvbicsIHQgPT4ge1xuXHRjb25zdCBpbnB1dCA9IHtleHRlbmRzOiBbJ2V4dGVuZGVyLW5hbWUnXX07XG5cdGNvbnN0IHByb3BhZ2F0ZWQgPSB7Zm9vOiAnYmFyJ307XG5cblx0Y29uc3QgYWN0dWFsID0gcmVzb2x2ZUV4dGVuZHMoaW5wdXQsIHtcblx0XHRyZXNvbHZlOiBpZCxcblx0XHRyZXF1aXJlKCkge1xuXHRcdFx0cmV0dXJuIHByb3BhZ2F0ZWQ7XG5cdFx0fVxuXHR9KTtcblxuXHR0LmlzKGFjdHVhbC5mb28sICdiYXInKTtcbn0pO1xuXG50ZXN0KCdyZXNvbHZlcyBleHRlbmRzIHJlY3Vyc2l2ZWx5JywgdCA9PiB7XG5cdGNvbnN0IGlucHV0ID0ge2V4dGVuZHM6IFsnZXh0ZW5kZXItbmFtZSddfTtcblx0Y29uc3QgYWN0dWFsID0gW107XG5cblx0cmVzb2x2ZUV4dGVuZHMoaW5wdXQsIHtcblx0XHRyZXNvbHZlOiBpZCxcblx0XHRyZXF1aXJlKGlkKSB7XG5cdFx0XHRhY3R1YWwucHVzaChpZCk7XG5cdFx0XHRpZiAoaWQgPT09ICdleHRlbmRlci1uYW1lJykge1xuXHRcdFx0XHRyZXR1cm4ge2V4dGVuZHM6IFsncmVjdXJzaXZlLWV4dGVuZGVyLW5hbWUnXX07XG5cdFx0XHR9XG5cdFx0XHRpZiAoaWQgPT09ICdyZWN1cnNpdmUtZXh0ZW5kZXItbmFtZScpIHtcblx0XHRcdFx0cmV0dXJuIHtmb286ICdiYXInfTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdHQuZGVlcEVxdWFsKGFjdHVhbCwgWydleHRlbmRlci1uYW1lJywgJ3JlY3Vyc2l2ZS1leHRlbmRlci1uYW1lJ10pO1xufSk7XG5cbnRlc3QoJ3VzZXMgcHJlZml4IGtleSByZWN1cnNpdmVseScsIHQgPT4ge1xuXHRjb25zdCBpbnB1dCA9IHtleHRlbmRzOiBbJ2V4dGVuZGVyLW5hbWUnXX07XG5cdGNvbnN0IGFjdHVhbCA9IFtdO1xuXG5cdHJlc29sdmVFeHRlbmRzKGlucHV0LCB7XG5cdFx0cHJlZml4OiAncHJlZml4Jyxcblx0XHRyZXNvbHZlOiBpZCxcblx0XHRyZXF1aXJlKGlkKSB7XG5cdFx0XHRhY3R1YWwucHVzaChpZCk7XG5cdFx0XHRpZiAoaWQgPT09ICdwcmVmaXgtZXh0ZW5kZXItbmFtZScpIHtcblx0XHRcdFx0cmV0dXJuIHtleHRlbmRzOiBbJ3JlY3Vyc2l2ZS1leHRlbmRlci1uYW1lJ119O1xuXHRcdFx0fVxuXHRcdFx0aWYgKGlkID09PSAncHJlZml4LXJlY3Vyc2l2ZS1leHRlbmRlci1uYW1lJykge1xuXHRcdFx0XHRyZXR1cm4ge2ZvbzogJ2Jhcid9O1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG5cblx0dC5kZWVwRXF1YWwoYWN0dWFsLCBbXG5cdFx0J3ByZWZpeC1leHRlbmRlci1uYW1lJyxcblx0XHQncHJlZml4LXJlY3Vyc2l2ZS1leHRlbmRlci1uYW1lJ1xuXHRdKTtcbn0pO1xuXG50ZXN0KCdwcm9wYWdhdGVzIGNvbnRlbnRzIHJlY3Vyc2l2ZWx5JywgdCA9PiB7XG5cdGNvbnN0IGlucHV0ID0ge2V4dGVuZHM6IFsnZXh0ZW5kZXItbmFtZSddfTtcblxuXHRjb25zdCBhY3R1YWwgPSByZXNvbHZlRXh0ZW5kcyhpbnB1dCwge1xuXHRcdHJlc29sdmU6IGlkLFxuXHRcdHJlcXVpcmUoaWQpIHtcblx0XHRcdGlmIChpZCA9PT0gJ2V4dGVuZGVyLW5hbWUnKSB7XG5cdFx0XHRcdHJldHVybiB7ZXh0ZW5kczogWydyZWN1cnNpdmUtZXh0ZW5kZXItbmFtZSddLCBmb286ICdiYXInfTtcblx0XHRcdH1cblx0XHRcdGlmIChpZCA9PT0gJ3JlY3Vyc2l2ZS1leHRlbmRlci1uYW1lJykge1xuXHRcdFx0XHRyZXR1cm4ge2JhejogJ2Jhcid9O1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG5cblx0Y29uc3QgZXhwZWN0ZWQgPSB7XG5cdFx0ZXh0ZW5kczogWydleHRlbmRlci1uYW1lJ10sXG5cdFx0Zm9vOiAnYmFyJyxcblx0XHRiYXo6ICdiYXInXG5cdH07XG5cblx0dC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG59KTtcblxudGVzdCgnZXh0ZW5kaW5nIGNvbnRlbnRzIHNob3VsZCB0YWtlIHByZWNlZGVuY2UnLCB0ID0+IHtcblx0Y29uc3QgaW5wdXQgPSB7ZXh0ZW5kczogWydleHRlbmRlci1uYW1lJ10sIHplcm86ICdyb290J307XG5cblx0Y29uc3QgYWN0dWFsID0gcmVzb2x2ZUV4dGVuZHMoaW5wdXQsIHtcblx0XHRyZXNvbHZlOiBpZCxcblx0XHRyZXF1aXJlKGlkKSB7XG5cdFx0XHRpZiAoaWQgPT09ICdleHRlbmRlci1uYW1lJykge1xuXHRcdFx0XHRyZXR1cm4ge2V4dGVuZHM6IFsncmVjdXJzaXZlLWV4dGVuZGVyLW5hbWUnXSwgemVybzogaWQsIG9uZTogaWR9O1xuXHRcdFx0fVxuXHRcdFx0aWYgKGlkID09PSAncmVjdXJzaXZlLWV4dGVuZGVyLW5hbWUnKSB7XG5cdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0ZXh0ZW5kczogWydzZWNvbmQtcmVjdXJzaXZlLWV4dGVuZGVyLW5hbWUnXSxcblx0XHRcdFx0XHR6ZXJvOiBpZCxcblx0XHRcdFx0XHRvbmU6IGlkLFxuXHRcdFx0XHRcdHR3bzogaWRcblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHRcdGlmIChpZCA9PT0gJ3NlY29uZC1yZWN1cnNpdmUtZXh0ZW5kZXItbmFtZScpIHtcblx0XHRcdFx0cmV0dXJuIHt6ZXJvOiBpZCwgb25lOiBpZCwgdHdvOiBpZCwgdGhyZWU6IGlkfTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdGNvbnN0IGV4cGVjdGVkID0ge1xuXHRcdGV4dGVuZHM6IFsnZXh0ZW5kZXItbmFtZSddLFxuXHRcdHplcm86ICdyb290Jyxcblx0XHRvbmU6ICdleHRlbmRlci1uYW1lJyxcblx0XHR0d286ICdyZWN1cnNpdmUtZXh0ZW5kZXItbmFtZScsXG5cdFx0dGhyZWU6ICdzZWNvbmQtcmVjdXJzaXZlLWV4dGVuZGVyLW5hbWUnXG5cdH07XG5cblx0dC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG59KTtcblxudGVzdCgnc2hvdWxkIGZhbGwgYmFjayB0byBjb252ZW50aW9uYWwtY2hhbmdlbG9nLWxpbnQtY29uZmlnIHByZWZpeCcsIHQgPT4ge1xuXHRjb25zdCBpbnB1dCA9IHtleHRlbmRzOiBbJ2V4dGVuZGVyLW5hbWUnXX07XG5cblx0Y29uc3QgYWN0dWFsID0gcmVzb2x2ZUV4dGVuZHMoaW5wdXQsIHtcblx0XHRwcmVmaXg6ICdwcmVmaXgnLFxuXHRcdHJlc29sdmUoaWQpIHtcblx0XHRcdGlmIChpZCA9PT0gJ2NvbnZlbnRpb25hbC1jaGFuZ2Vsb2ctbGludC1jb25maWctZXh0ZW5kZXItbmFtZScpIHtcblx0XHRcdFx0cmV0dXJuICdjb252ZW50aW9uYWwtY2hhbmdlbG9nLWxpbnQtY29uZmlnLWV4dGVuZGVyLW5hbWUnO1xuXHRcdFx0fVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZmluZCBtb2R1bGUgXCIqJHtpZH1cImApO1xuXHRcdH0sXG5cdFx0cmVxdWlyZShpZCkge1xuXHRcdFx0aWYgKGlkID09PSAnY29udmVudGlvbmFsLWNoYW5nZWxvZy1saW50LWNvbmZpZy1leHRlbmRlci1uYW1lJykge1xuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdHJ1bGVzOiB7XG5cdFx0XHRcdFx0XHRmYWxsYmFjazogdHJ1ZVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xuXG5cdHQuZGVlcEVxdWFsKGFjdHVhbCwge1xuXHRcdGV4dGVuZHM6IFsnZXh0ZW5kZXItbmFtZSddLFxuXHRcdHJ1bGVzOiB7XG5cdFx0XHRmYWxsYmFjazogdHJ1ZVxuXHRcdH1cblx0fSk7XG59KTtcbiJdfQ==