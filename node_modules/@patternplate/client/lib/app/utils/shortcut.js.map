{"version":3,"sources":["../../../src/app/utils/shortcut.js"],"names":["CODES","esc","space","c","d","e","f","h","i","o","k","l","m","n","r","t","Shortcut","constructor","action","character","description","modifiers","code","key","active","global","bind","store","onKeyPress","every","keyCode","dispatch","addEventListener","message","parse","data","type","payload","err","prevent","altKey","ctrlKey","preventDefault","toString","keys","map","replace","join"],"mappings":";;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,QAAQ;AACZ,cAAY,EADA;AAEZ,iBAAe,EAFH;AAGZ,gBAAc,EAHF;AAIZ,gBAAc,EAJF;AAKZC,OAAK,EALO;AAMZC,SAAO,EANK;AAOZC,KAAG,EAPS;AAQZC,KAAG,EARS;AASZC,KAAG,EATS;AAUZC,KAAG,EAVS;AAWZC,KAAG,EAXS;AAYZC,KAAG,EAZS;AAaZC,KAAG,EAbS;AAcZC,KAAG,EAdS;AAeZC,KAAG,EAfS;AAgBZC,KAAG,EAhBS;AAiBZC,KAAG,EAjBS;AAkBZC,KAAG,EAlBS;AAmBZC,KAAG;AAnBS,CAAd;;AAsBe,MAAMC,QAAN,CAAe;AAC5BC,cAAY;AAAEC,UAAF;AAAUC,aAAV;AAAqBC,eAArB;AAAkCC;AAAlC,GAAZ,EAA2D;AACzD,SAAKF,SAAL,GAAiBA,SAAjB;AACA,SAAKG,IAAL,GAAYtB,MAAMmB,SAAN,CAAZ;AACA,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKK,GAAL,GAAW,KAAKL,MAAL,CAAYK,GAAvB;AACA,SAAKC,MAAL,GAAc,cAAcC,MAA5B;AACA,SAAKL,WAAL,GAAmBA,WAAnB;AACA,SAAKC,SAAL,GAAiBA,aAAa,CAAC,SAAD,EAAY,QAAZ,CAA9B;AACA,SAAKK,IAAL,GAAY,KAAKA,IAAL,CAAUA,IAAV,CAAe,IAAf,CAAZ;AACD;;AAEDA,OAAKC,KAAL,EAAY;AACV,QAAI,CAAC,KAAKH,MAAV,EAAkB;AAChB;AACD;;AAED,UAAMI,aAAavB,KAAK;AACtB,UAAI,CAAC,KAAKgB,SAAL,CAAeQ,KAAf,CAAqBjB,KAAKP,EAAEO,CAAF,CAA1B,CAAL,EAAsC;AACpC;AACD;;AAED,UAAIP,EAAEyB,OAAF,KAAc,KAAKR,IAAvB,EAA6B;AAC3B,eAAO,KAAP;AACD;;AAEDK,YAAMI,QAAN,CAAe,KAAKb,MAAL,EAAf;AACD,KAVD;;AAYAO,WAAOO,gBAAP,CAAwB,SAAxB,EAAmC3B,KAAK;AACtC,UAAI;AACF,cAAM4B,UAAU,eAAMC,KAAN,CAAY7B,EAAE8B,IAAd,CAAhB;;AACA,YAAIF,QAAQG,IAAR,KAAiB,SAArB,EAAgC;AAC9BR,qBAAWK,QAAQI,OAAnB;AACD;AACF,OALD,CAKE,OAAOC,GAAP,EAAY,CAEb;AACF,KATD,EASG,KATH;AAWAb,WAAOO,gBAAP,CAAwB,SAAxB,EAAmC3B,KAAK;AACtC,YAAMkC,UAAUX,WAAW;AACzBY,gBAAQnC,EAAEmC,MADe;AAEzBC,iBAASpC,EAAEoC,OAFc;AAGzBX,iBAAS,CAACzB,EAAE8B,IAAF,IAAU9B,CAAX,EAAcyB;AAHE,OAAX,CAAhB;;AAKA,UAAIS,OAAJ,EAAa;AACXlC,UAAEqC,cAAF;AACD;AACF,KATD;AAUD;;AAEDC,aAAW;AACT,UAAMC,OAAO,CAAC,GAAG,KAAKvB,SAAT,EAAoB,KAAKF,SAAzB,EAAoC0B,GAApC,CAAwC1C,KACnDA,EAAE2C,OAAF,CAAU,KAAV,EAAiB,EAAjB,CADW,CAAb;AAGA,WAAQ,IAAGF,KAAKG,IAAL,CAAU,GAAV,CAAe,GAA1B;AACD;;AAzD2B","file":"shortcut.js","sourcesContent":["import ARSON from \"arson\";\nimport assert from \"assert\";\n\nconst CODES = {\n  \"arrow-up\": 38,\n  \"arrow-right\": 39,\n  \"arrow-down\": 40,\n  \"arrow-left\": 37,\n  esc: 27,\n  space: 32,\n  c: 67,\n  d: 68,\n  e: 69,\n  f: 70,\n  h: 72,\n  i: 73,\n  o: 79,\n  k: 75,\n  l: 76,\n  m: 77,\n  n: 78,\n  r: 82,\n  t: 84\n};\n\nexport default class Shortcut {\n  constructor({ action, character, description, modifiers }) {\n    this.character = character;\n    this.code = CODES[character];\n    this.action = action;\n    this.key = this.action.key;\n    this.active = \"document\" in global;\n    this.description = description;\n    this.modifiers = modifiers || [\"ctrlKey\", \"altKey\"];\n    this.bind = this.bind.bind(this);\n  }\n\n  bind(store) {\n    if (!this.active) {\n      return;\n    }\n\n    const onKeyPress = e => {\n      if (!this.modifiers.every(m => e[m])) {\n        return;\n      }\n\n      if (e.keyCode !== this.code) {\n        return false;\n      }\n\n      store.dispatch(this.action());\n    };\n\n    global.addEventListener(\"message\", e => {\n      try {\n        const message = ARSON.parse(e.data);\n        if (message.type === \"keydown\") {\n          onKeyPress(message.payload);\n        }\n      } catch (err) {\n\n      }\n    }, false);\n\n    global.addEventListener(\"keydown\", e => {\n      const prevent = onKeyPress({\n        altKey: e.altKey,\n        ctrlKey: e.ctrlKey,\n        keyCode: (e.data ||Â e).keyCode,\n      });\n      if (prevent) {\n        e.preventDefault();\n      }\n    });\n  }\n\n  toString() {\n    const keys = [...this.modifiers, this.character].map(c =>\n      c.replace(\"Key\", \"\")\n    );\n    return `[${keys.join(\"+\")}]`;\n  }\n}\n"]}