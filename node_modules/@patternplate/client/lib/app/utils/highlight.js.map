{"version":3,"sources":["../../../src/app/utils/highlight.js"],"names":["highlight","startWorker","url","global","Worker","options","Promise","resolve","reject","worker","onWorkerMessage","e","data","parse","id","payload","type","error","removeEventListener","addEventListener","postMessage","stringify"],"mappings":";;;;;;;AAAA;;AACA;;;;eAEeA,S;;AAEf,MAAMC,cAAc,qBAAQC,OAAO;AAAA,kBACdC,MADc;AAAA,QACzBC,MADyB,WACzBA,MADyB;AAEjC,SAAO,IAAIA,MAAJ,CAAWF,GAAX,CAAP;AACD,CAHmB,CAApB;;AAKA,SAASF,SAAT,CAAmBK,OAAnB,EAA4B;AAC1B,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMC,SAASR,YAAYI,QAAQI,MAApB,CAAf;;AAEA,UAAMC,kBAAkBC,KAAK;AAC3B,YAAMC,OAAO,eAAMC,KAAN,CAAYF,EAAEC,IAAd,CAAb;;AAEA,UAAIA,KAAKE,EAAL,KAAYT,QAAQS,EAAxB,EAA4B;AAC1B;AACD;;AAED,UAAIF,KAAKG,OAAL,CAAaC,IAAb,KAAsB,OAA1B,EAAmC;AACjC,eAAOR,OAAOI,KAAKG,OAAL,CAAaE,KAApB,CAAP;AACD;;AAEDV,cAAQK,IAAR;AACAH,aAAOS,mBAAP,CAA2B,SAA3B,EAAsCR,eAAtC;AACD,KAbD;;AAeAD,WAAOU,gBAAP,CAAwB,SAAxB,EAAmCT,eAAnC;AACAD,WAAOW,WAAP,CAAmB,eAAMC,SAAN,CAAgBhB,OAAhB,CAAnB;AACD,GApBM,CAAP;AAqBD","file":"highlight.js","sourcesContent":["import ARSON from \"arson\";\nimport { memoize } from \"lodash\";\n\nexport default highlight;\n\nconst startWorker = memoize(url => {\n  const { Worker } = global;\n  return new Worker(url);\n});\n\nfunction highlight(options) {\n  return new Promise((resolve, reject) => {\n    const worker = startWorker(options.worker);\n\n    const onWorkerMessage = e => {\n      const data = ARSON.parse(e.data);\n\n      if (data.id !== options.id) {\n        return;\n      }\n\n      if (data.payload.type === \"error\") {\n        return reject(data.payload.error);\n      }\n\n      resolve(data);\n      worker.removeEventListener(\"message\", onWorkerMessage);\n    };\n\n    worker.addEventListener(\"message\", onWorkerMessage);\n    worker.postMessage(ARSON.stringify(options));\n  });\n}\n"]}