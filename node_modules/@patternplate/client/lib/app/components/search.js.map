{"version":3,"sources":["../../../src/app/components/search.js"],"names":["InfoPane","SearchComponent","Search","SearchResult","SearchResultList","SearchResultHeading","SearchResultPreview","SearchFieldSlot","SearchClose","Close","SearchPassThroughSlot","PassThroughSlot","NOOP","Component","constructor","args","item","type","props","activeItem","id","contentType","join","index","manifest","icon","displayName","onActivate","handleScrollRequest","contents","demoDependencies","demoDependents","dependencies","dependents","flag","JSON","stringify","tags","version","handleSubmit","bind","handleUp","handleDown","handleActivate","getListRef","getSearchResult","e","list","l","getBoundingClientRect","i","target","bottom","scrollTop","offsetTop","height","top","ref","componentDidMount","onMount","getAttribute","docs","components","findIndex","stopPropagation","preventDefault","onUp","available","length","onDown","onSubmit","onNavigate","render","withComponents","withDocs","enabled","inline","onClickOutside","onBlur","onChange","onClear","onComplete","onFocus","onStop","shortcuts","suggestion","legend","map","d","navigationEnabled","getSearchResultPreview","onClose","toggleSearch","toString","value","close","search"],"mappings":"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","file":"search.js","sourcesContent":["import url from \"url\";\nimport { values } from \"lodash\";\nimport React from \"react\";\nimport {\n  Search as SearchComponents,\n  InnerInfoPane,\n  Icon,\n  Link,\n  Markdown,\n  styled,\n  Text\n} from \"@patternplate/components\";\nimport tag from \"tag-hoc\";\n\nimport Outside from \"./outside\";\nimport SearchField from \"./search-field\";\nimport withToggleStates from \"../connectors/with-toggle-states\";\nimport PassThrough from \"../containers/pass-through\";\n\nconst InfoPane = withToggleStates(InnerInfoPane);\nconst {\n  Search: SearchComponent,\n  SearchResult,\n  SearchResultList,\n  SearchResultHeading,\n  SearchResultPreview,\n  SearchFieldSlot,\n  Close: SearchClose,\n  PassThroughSlot: SearchPassThroughSlot\n} = SearchComponents;\n\nconst NOOP = () => { };\n\nexport default class Search extends React.Component {\n  constructor(...args) {\n    super(...args);\n\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleUp = this.handleUp.bind(this);\n    this.handleDown = this.handleDown.bind(this);\n    this.handleActivate = this.handleActivate.bind(this);\n    this.handleScrollRequest = this.handleScrollRequest.bind(this);\n    this.getListRef = this.getListRef.bind(this);\n    this.getSearchResult = this.getSearchResult.bind(this);\n  }\n\n  handleScrollRequest(e) {\n    if (!this.list) {\n      return;\n    }\n    const l = this.list.getBoundingClientRect();\n    const i = e.target.getBoundingClientRect();\n\n    if (i.bottom > l.bottom) {\n      this.list.scrollTop = e.target.offsetTop - l.height + i.height;\n    }\n\n    if (i.top < l.top) {\n      this.list.scrollTop = e.target.offsetTop - 30;\n    }\n  }\n\n  getListRef(ref) {\n    this.list = ref;\n  }\n\n  getSearchResult = (item, type) => (\n    <SearchResult\n      active={(this.props.activeItem || {}).id === item.id}\n      href={[item.contentType, item.id].join('/')}\n      id={item.id}\n      index={item.index}\n      icon={item.manifest.icon || item.type}\n      name={item.manifest.displayName}\n      key={item.id}\n      onActivate={this.props.onActivate}\n      onScrollRequest={this.handleScrollRequest}\n      type={type}\n    />\n  );\n\n  getSearchResultPreview = () => {\n    const item = this.props.activeItem;\n\n    switch (item.contentType) {\n      case \"doc\":\n        return (\n          <SearchResultPreview {...this.props}>\n            <Markdown\n              source={item.contents}\n              />\n          </SearchResultPreview>\n        );\n      default:\n        return (\n          <SearchResultPreview {...this.props}>\n            <InfoPane\n              active\n              demoDependencies={values(item.demoDependencies)}\n              demoDependents={values(item.demoDependents)}\n              dependencies={values(item.dependencies)}\n              dependents={values(item.dependents)}\n              flag={item.manifest.flag}\n              id={item.id}\n              manifest={JSON.stringify(item.manifest, null, \"  \")}\n              name={item.manifest.displayName}\n              tags={item.manifest.tags}\n              version={item.manifest.version}\n            />\n          </SearchResultPreview>\n        );\n    }\n  }\n\n  componentDidMount() {\n    if (typeof this.props.onMount === \"function\") {\n      this.props.onMount();\n    }\n  }\n\n  handleActivate(e) {\n    const id = e.target.getAttribute(\"data-id\");\n    const index = [...this.props.docs, ...this.props.components].findIndex(\n      i => i.id === id\n    );\n\n    if (index > -1) {\n      this.props.onActivate(index);\n    }\n  }\n\n  handleUp(e) {\n    e.stopPropagation();\n    if (this.props.activeItem && this.props.activeItem.index > 0) {\n      e.preventDefault();\n      this.props.onUp();\n    }\n  }\n\n  handleDown(e) {\n    e.stopPropagation();\n    const available = this.props.components.length + this.props.docs.length - 2;\n\n    if (this.props.activeItem && available >= this.props.activeItem.index) {\n      this.props.onDown();\n    }\n  }\n\n  handleSubmit(e) {\n    e.preventDefault();\n    const {props} = this;\n\n    if (!props.activeItem) {\n      return props.onSubmit(e);\n    }\n\n    const {activeItem} = props;\n    props.onNavigate(activeItem);\n  }\n\n  render() {\n    const { props } = this;\n\n    const withComponents = props.components.length > 0;\n    const withDocs = props.docs.length > 0;\n\n    return (\n      <SearchComponent\n        activeItem={props.activeItem}\n        docs={props.docs}\n        enabled={props.enabled}\n        inline={props.inline}\n        onActivate={props.inline ? NOOP : this.handleActivate}\n        onClickOutside={props.inline ? NOOP : props.onClickOutside}\n        onBlur={props.inline ? NOOP : props.onBlur}\n        onChange={props.inline ? NOOP : props.onChange}\n        onClear={props.inline ? NOOP : props.onClear}\n        onComplete={props.inline ? NOOP : props.onComplete}\n        onDown={props.inline ? NOOP : this.handleDown}\n        onFocus={props.inline ? NOOP : props.onFocus}\n        onStop={props.inline ? NOOP : props.onStop}\n        onSubmit={props.inline ? NOOP : this.handleSubmit}\n        onUp={props.inline ? NOOP : this.handleUp}\n        shortcuts={props.shortcuts}\n        suggestion={props.suggestion}\n        legend={props.legend}\n      >\n        <SearchResultList innerRef={this.getListRef}>\n          {withDocs > 0 && (\n            <SearchResultHeading>Docs ({props.docs.length})</SearchResultHeading>\n          )}\n\n          {props.docs.map(d => this.getSearchResult(d, \"doc\", props))}\n\n          {withComponents > 0 && (\n            <SearchResultHeading navigationEnabled={props.navigationEnabled}>\n              Components ({props.components.length})\n            </SearchResultHeading>\n          )}\n\n          {props.components.map(d => this.getSearchResult(d, \"pattern\"))}\n        </SearchResultList>\n\n        {(withComponents || withDocs) && this.getSearchResultPreview()}\n\n        <SearchFieldSlot>\n          <SearchField\n            autoFocus={!props.inline}\n            linkTo=\"/search\"\n            mark={props.inline ? null : true}\n            name={props.inline ? \"inline-search\" : \"search\"}\n            onBlur={props.onBlur}\n            onChange={props.onChange}\n            onClear={props.onClear}\n            onClose={props.onClose}\n            onComplete={props.onComplete}\n            onDown={this.handleDown}\n            onFocus={props.onFocus}\n            onStop={props.onStop}\n            onUp={this.handleUp}\n            placeholder=\"Search\"\n            suggestion={props.suggestion}\n            title={`Search for patterns ${props.shortcuts.toggleSearch.toString()}`}\n            value={props.value}\n          >\n            {props.enabled &&\n              <SearchClose\n                shortcut={props.shortcuts.close}\n                clears={typeof props.value === \"string\" && props.value.length > 0}\n              />\n            }\n          </SearchField>\n        </SearchFieldSlot>\n        <SearchPassThroughSlot>\n          <PassThrough query={{ \"search-enabled\": true, search: null }} />\n        </SearchPassThroughSlot>\n      </SearchComponent>\n    );\n  }\n}\n"]}