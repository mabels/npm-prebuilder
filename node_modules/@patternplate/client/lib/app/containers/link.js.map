{"version":3,"sources":["../../../src/app/containers/link.js"],"names":["mapState","mapDispatch","RawLink","state","own","location","routing","locationBeforeTransitions","Object","assign","href","getHref","base","dispatch","ownProps","onClick","e","external","type","preventDefault","parsed","parse","currentTarget","hash","slice","path","join","props","context","pathname","query","stringify","value","key","hasOwnProperty","prefix","format","b","norm","p","startsWith","split","filter","Boolean"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;eAEe,yBAAQA,QAAR,EAAkBC,WAAlB,EAA+B,iBAAKC,OAApC,C;;;;AAEf,SAASF,QAAT,CAAkBG,KAAlB,EAAyBC,GAAzB,EAA8B;AAC5B,QAAMC,WAAWF,MAAMG,OAAN,CAAcC,yBAA/B;AACA,SAAOC,OAAOC,MAAP,CAAc,EAAd,EAAkBL,GAAlB,EACL;AAACM,UAAMC,QAAQP,GAAR,EAAa;AAAEQ,YAAMT,MAAMS,IAAd;AAAoBP;AAApB,KAAb;AAAP,GADK,CAAP;AAGD;;AAED,SAASJ,WAAT,CAAqBY,QAArB,EAA+BC,QAA/B,EAAyC;AACvC,SAAO,+BACL;AACEC,YAAQC,CAAR,EAAW;AACT,UAAIF,SAASG,QAAb,EAAuB;AACrB,eAAO;AAAEC,gBAAM;AAAR,SAAP;AACD;;AACDF,QAAEG,cAAF;;AACA,YAAMC,SAAS,aAAIC,KAAJ,CAAUL,EAAEM,aAAF,CAAgBZ,IAA1B,CAAf;;AAEA,UAAIU,OAAOG,IAAX,EAAiB;AACf,+BAASH,OAAOG,IAAP,CAAYC,KAAZ,CAAkB,CAAlB,CAAT;AACD;;AAED,aAAO,4BAAK,CAACJ,OAAOK,IAAR,EAAcL,OAAOG,IAArB,EAA2BG,IAA3B,CAAgC,EAAhC,CAAL,CAAP;AACD;;AAbH,GADK,EAgBLb,QAhBK,CAAP;AAkBD;;AAED,SAASF,OAAT,CAAiBgB,KAAjB,EAAwBC,OAAxB,EAAiC;AAC/B,MAAID,MAAMV,QAAN,KAAmB,IAAnB,IAA2B,CAACW,QAAQvB,QAAxC,EAAkD;AAChD,WAAOsB,MAAMjB,IAAb;AACD;;AAED,QAAMU,SAASO,MAAMjB,IAAN,GACX,aAAIW,KAAJ,CAAUM,MAAMjB,IAAhB,CADW,GAEX;AACEmB,cAAUD,QAAQvB,QAAR,CAAiBwB,QAD7B;AAEEC,WAAO,qBAAYC,SAAZ,CAAsBH,QAAQvB,QAAR,CAAiByB,KAAvC;AAFT,GAFJ;AAOAV,SAAOU,KAAP,GAAe,qBAAYT,KAAZ,CAAkBD,OAAOU,KAAzB,CAAf;AAEA,QAAMA,QAAQH,MAAMG,KAAN,KAAgB,IAAhB,GACV,EADU,GAEV,oBACAtB,OAAOC,MAAP,CACE,EADF,EAEEmB,QAAQvB,QAAR,CAAiByB,KAFnB,EAGEV,OAAOU,KAHT,EAIEH,MAAMG,KAAN,IAAeF,QAAQvB,QAAR,CAAiByB,KAJlC,CADA,EAOA,CAACE,KAAD,EAAQC,GAAR,KAAgB;AACd;AACA;AACA,QAAIA,QAAQ,oBAAZ,EAAkC;AAChC,aAAOD,UAAU,IAAV,IAAkBA,UAAU,MAAnC;AACD,KALa,CAOd;;;AACA,QAAI,CAACJ,QAAQvB,QAAR,CAAiByB,KAAjB,CAAuBI,cAAvB,CAAsCD,GAAtC,CAAL,EAAiD;AAC/C,aAAO,IAAP;AACD,KAVa,CAWd;;;AACA,WAAOD,UAAU,OAAV,IAAqBA,UAAU,GAA/B,IAAsC,CAAC,CAAEA,KAAhD;AACD,GApBD,CAFJ;AAyBA,QAAMH,WACJ,OAAOT,OAAOS,QAAd,KAA2B,QAA3B,GACIM,OAAOP,QAAQhB,IAAf,EAAqBQ,OAAOS,QAA5B,CADJ,GAEID,QAAQvB,QAAR,CAAiBwB,QAHvB;AAKA,SAAO,aAAIO,MAAJ,CAAW;AAChBP,YADgB;AAEhBC,SAFgB;AAGhBP,UAAMI,MAAMJ,IAAN,IAAc,CAACH,OAAOG,IAAP,IAAe,GAAhB,EAAqBC,KAArB,CAA2B,CAA3B;AAHJ,GAAX,CAAP;AAKD;;AAED,SAASW,MAAT,CAAgBvB,IAAhB,EAAsBiB,QAAtB,EAAgC;AAC9B,QAAMQ,IAAIC,KAAK1B,IAAL,CAAV;AACA,QAAM2B,IAAID,KAAKT,QAAL,CAAV;;AAEA,MAAIU,MAAM,EAAV,EAAc;AACZ,WAAQ,IAAGF,CAAE,EAAb;AACD;;AAED,MAAIE,EAAEC,UAAF,CAAaH,CAAb,CAAJ,EAAqB;AACnB,WAAQ,IAAGE,CAAE,EAAb;AACD;;AAED,SAAQ,IAAG,CAACD,KAAK1B,IAAL,CAAD,EAAa0B,KAAKT,QAAL,CAAb,EAA6BH,IAA7B,CAAkC,GAAlC,CAAuC,EAAlD;AACD;;AAED,SAASY,IAAT,CAAcC,CAAd,EAAiB;AACf,SAAOA,EAAEE,KAAF,CAAQ,GAAR,EAAaC,MAAb,CAAoBC,OAApB,EAA6BjB,IAA7B,CAAkC,GAAlC,CAAP;AACD","file":"link.js","sourcesContent":["import url from \"url\";\nimport queryString from \"querystring\";\nimport { Link } from \"@patternplate/components\";\nimport { pickBy } from \"lodash\";\nimport { connect } from \"react-redux\";\nimport { push } from \"react-router-redux\";\nimport { bindActionCreators } from \"redux\";\nimport { scrollTo } from \"../actions\";\n\nexport default connect(mapState, mapDispatch)(Link.RawLink);\n\nfunction mapState(state, own) {\n  const location = state.routing.locationBeforeTransitions;\n  return Object.assign({}, own,\n    {href: getHref(own, { base: state.base, location })}\n  );\n}\n\nfunction mapDispatch(dispatch, ownProps) {\n  return bindActionCreators(\n    {\n      onClick(e) {\n        if (ownProps.external) {\n          return { type: null };\n        }\n        e.preventDefault();\n        const parsed = url.parse(e.currentTarget.href);\n\n        if (parsed.hash) {\n          scrollTo(parsed.hash.slice(1));\n        }\n\n        return push([parsed.path, parsed.hash].join(\"\"));\n      }\n    },\n    dispatch\n  );\n}\n\nfunction getHref(props, context) {\n  if (props.external === true || !context.location) {\n    return props.href;\n  }\n\n  const parsed = props.href\n    ? url.parse(props.href)\n    : {\n        pathname: context.location.pathname,\n        query: queryString.stringify(context.location.query)\n      };\n\n  parsed.query = queryString.parse(parsed.query);\n\n  const query = props.query === null\n    ? {}\n    : pickBy(\n      Object.assign(\n        {},\n        context.location.query,\n        parsed.query,\n        props.query || context.location.query\n      ),\n      (value, key) => {\n        // TODO: deduce this for all keys from reduce config\n        // special case \"navigation-enabled\", invert logic\n        if (key === \"navigation-enabled\") {\n          return value !== true && value !== \"true\";\n        }\n\n        // if the key is not in the current query, add it\n        if (!context.location.query.hasOwnProperty(key)) {\n          return true;\n        }\n        // omit \"falsy\" values to keep url shorter\n        return value !== \"false\" && value !== \"0\" && !!(value);\n      }\n    );\n\n  const pathname =\n    typeof parsed.pathname === \"string\"\n      ? prefix(context.base, parsed.pathname)\n      : context.location.pathname;\n\n  return url.format({\n    pathname,\n    query,\n    hash: props.hash || (parsed.hash || \"#\").slice(1)\n  });\n}\n\nfunction prefix(base, pathname) {\n  const b = norm(base);\n  const p = norm(pathname);\n\n  if (p === '') {\n    return `/${b}`;\n  }\n\n  if (p.startsWith(b)) {\n    return `/${p}`;\n  }\n\n  return `/${[norm(base), norm(pathname)].join(\"/\")}`;\n}\n\nfunction norm(p) {\n  return p.split(\"/\").filter(Boolean).join(\"/\");\n}\n"]}