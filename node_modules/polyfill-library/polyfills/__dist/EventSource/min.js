!function(t){"use strict";function e(t,e,s,n,h){this._internal=new i(t,e,s,n,h)}function i(t,e,i,s,n){this.onStartCallback=e,this.onProgressCallback=i,this.onFinishCallback=s,this.thisArg=n,this.xhr=t,this.state=0,this.charOffset=0,this.offset=0,this.url="",this.withCredentials=!1,this.timeout=0}function s(){this._data={}}function n(){this._listeners=new s}function h(t){d(function(){throw t},0)}function r(t){this.type=t,this.target=undefined}function a(t,e){r.call(this,t),this.data=e.data,this.lastEventId=e.lastEventId}function o(t,e){n.call(this),this.onopen=undefined,this.onmessage=undefined,this.onerror=undefined,this.url="",this.readyState=g,this.withCredentials=!1,this._internal=new u(this,t,e)}function u(t,i,s){this.url=i.toString(),this.readyState=g,this.withCredentials=v&&s!=undefined&&Boolean(s.withCredentials),this.es=t,this.initialRetry=w(1e3,0),this.heartbeatTimeout=w(45e3,0),this.lastEventId="",this.retry=this.initialRetry,this.wasActivity=!1;var n=s!=undefined&&s.Transport!=undefined?s.Transport:m,h=new n;this.transport=new e(h,this.onStart,this.onProgress,this.onFinish,this),this.timeout=0,this.currentState=S,this.dataBuffer=[],this.lastEventIdBuffer="",this.eventTypeBuffer="",this.state=E,this.fieldStart=0,this.valueStart=0,this.es.url=this.url,this.es.readyState=this.readyState,this.es.withCredentials=this.withCredentials,this.onTimeout()}function c(){this.CONNECTING=g,this.OPEN=C,this.CLOSED=x}var d=t.setTimeout,f=t.clearTimeout,l=function(){};e.prototype.open=function(t,e){this._internal.open(t,e)},e.prototype.cancel=function(){this._internal.cancel()},i.prototype.onStart=function(){if(1===this.state){this.state=2;var t=0,e="",i=undefined;if("contentType"in this.xhr)t=200,e="OK",i=this.xhr.contentType;else try{t=this.xhr.status,e=this.xhr.statusText,i=this.xhr.getResponseHeader("Content-Type")}catch(s){t=0,e="",i=undefined}i==undefined&&(i=""),this.onStartCallback.call(this.thisArg,t,e,i)}},i.prototype.onProgress=function(){if(this.onStart(),2===this.state||3===this.state){this.state=3;var t="";try{t=this.xhr.responseText}catch(r){}for(var e=this.charOffset,i=t.length,s=this.offset;s<i;s+=1){var n=t.charCodeAt(s);n!=="\n".charCodeAt(0)&&n!=="\r".charCodeAt(0)||(this.charOffset=s+1)}this.offset=i;var h=t.slice(e,this.charOffset);this.onProgressCallback.call(this.thisArg,h)}},i.prototype.onFinish=function(){this.onProgress(),3===this.state&&(this.state=4,0!==this.timeout&&(f(this.timeout),this.timeout=0),this.onFinishCallback.call(this.thisArg))},i.prototype.onReadyStateChange=function(){this.xhr!=undefined&&(4===this.xhr.readyState?(this.xhr.status,this.onFinish()):3===this.xhr.readyState?this.onProgress():this.xhr.readyState)},i.prototype.onTimeout2=function(){this.timeout=0;var e=/^data\:([^,]*?)(base64)?,([\S]*)$/.exec(this.url),i=e[1],s="base64"===e[2]?t.atob(e[3]):decodeURIComponent(e[3]);1===this.state&&(this.state=2,this.onStartCallback.call(this.thisArg,200,"OK",i)),2!==this.state&&3!==this.state||(this.state=3,this.onProgressCallback.call(this.thisArg,s)),3===this.state&&(this.state=4,this.onFinishCallback.call(this.thisArg))},i.prototype.onTimeout1=function(){this.timeout=0,this.open(this.url,this.withCredentials)},i.prototype.onTimeout0=function(){var t=this;this.timeout=d(function(){t.onTimeout0()},500),3===this.xhr.readyState&&this.onProgress()},i.prototype.handleEvent=function(t){"load"===t.type?this.onFinish():"error"===t.type?this.onFinish():"abort"===t.type?this.onFinish():"progress"===t.type?this.onProgress():"readystatechange"===t.type&&this.onReadyStateChange()},i.prototype.open=function(e,i){this.cancel(),this.url=e,this.withCredentials=i,this.state=1,this.charOffset=0,this.offset=0;var s=this;if(/^data\:([^,]*?)(?:;base64)?,[\S]*$/.exec(e)!=undefined)return void(this.timeout=d(function(){s.onTimeout2()},0));if((!("ontimeout"in this.xhr)||"sendAsBinary"in this.xhr||"mozAnon"in this.xhr)&&t.document!=undefined&&t.document.readyState!=undefined&&"complete"!==t.document.readyState)return void(this.timeout=d(function(){s.onTimeout1()},4));this.xhr.onload=function(t){s.handleEvent({type:"load"})},this.xhr.onerror=function(){s.handleEvent({type:"error"})},this.xhr.onabort=function(){s.handleEvent({type:"abort"})},this.xhr.onprogress=function(){s.handleEvent({type:"progress"})},this.xhr.onreadystatechange=function(){s.handleEvent({type:"readystatechange"})},this.xhr.open("GET",e,!0),this.xhr.withCredentials=i,this.xhr.responseType="text","setRequestHeader"in this.xhr&&this.xhr.setRequestHeader("Accept","text/event-stream");try{this.xhr.send(undefined)}catch(n){throw n}"readyState"in this.xhr&&t.opera!=undefined&&(this.timeout=d(function(){s.onTimeout0()},0))},i.prototype.cancel=function(){0!==this.state&&4!==this.state&&(this.state=4,this.xhr.onload=l,this.xhr.onerror=l,this.xhr.onabort=l,this.xhr.onprogress=l,this.xhr.onreadystatechange=l,this.xhr.abort(),0!==this.timeout&&(f(this.timeout),this.timeout=0),this.onFinishCallback.call(this.thisArg)),this.state=0},s.prototype.get=function(t){return this._data[t+"~"]},s.prototype.set=function(t,e){this._data[t+"~"]=e},s.prototype["delete"]=function(t){delete this._data[t+"~"]},n.prototype.dispatchEvent=function(t){t.target=this;var e=t.type.toString(),i=this._listeners,s=i.get(e);if(s!=undefined)for(var n=s.length,r=undefined,a=0;a<n;a+=1){r=s[a];try{"function"==typeof r.handleEvent?r.handleEvent(t):r.call(this,t)}catch(o){h(o)}}},n.prototype.addEventListener=function(t,e){t=t.toString();var i=this._listeners,s=i.get(t);s==undefined&&(s=[],i.set(t,s));for(var n=s.length;n>=0;n-=1)if(s[n]===e)return;s.push(e)},n.prototype.removeEventListener=function(t,e){t=t.toString();var i=this._listeners,s=i.get(t);if(s!=undefined){for(var n=s.length,h=[],r=0;r<n;r+=1)s[r]!==e&&h.push(s[r]);0===h.length?i["delete"](t):i.set(t,h)}},a.prototype=r.prototype;var p=t.XMLHttpRequest,y=t.XDomainRequest,v=p!=undefined&&(new p).withCredentials!=undefined,m=v||p!=undefined&&y==undefined?p:y,S=-1,g=0,C=1,x=2,E=4,T=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,w=function(t,e){var i=t;return i!==i&&(i=e),i<1e3?1e3:i>18e6?18e6:i},b=function(t,e,i){try{"function"==typeof e&&e.call(t,i)}catch(s){h(s)}};u.prototype.onStart=function(t,e,i){if(this.currentState===g)if(i==undefined&&(i=""),200===t&&T.test(i)){this.currentState=C,this.wasActivity=!0,this.retry=this.initialRetry,this.readyState=C,this.es.readyState=C;var s=new r("open");this.es.dispatchEvent(s),b(this.es,this.es.onopen,s)}else if(0!==t){var n="";n=200!==t?"EventSource's response has a status "+t+" "+e.replace(/\s+/g," ")+" that is not 200. Aborting the connection.":"EventSource's response has a Content-Type specifying an unsupported type: "+i.replace(/\s+/g," ")+". Aborting the connection.",h(new Error(n)),this.close();var s=new r("error");this.es.dispatchEvent(s),b(this.es,this.es.onerror,s)}},u.prototype.onProgress=function(t){if(this.currentState===C){var e=t.length;0!==e&&(this.wasActivity=!0);for(var i=0;i<e;i+=1){var s=t.charCodeAt(i);if(3===this.state&&s==="\n".charCodeAt(0))this.state=E;else if(3===this.state&&(this.state=E),s==="\r".charCodeAt(0)||s==="\n".charCodeAt(0)){if(this.state!==E){5===this.state&&(this.valueStart=i+1);var n=t.slice(this.fieldStart,this.valueStart-1),h=t.slice(this.valueStart+(this.valueStart<i&&t.charCodeAt(this.valueStart)===" ".charCodeAt(0)?1:0),i);if("data"===n)this.dataBuffer.push(h);else if("id"===n)this.lastEventIdBuffer=h;else if("event"===n)this.eventTypeBuffer=h;else if("retry"===n)this.initialRetry=w(Number(h),this.initialRetry),this.retry=this.initialRetry;else if("heartbeatTimeout"===n&&(this.heartbeatTimeout=w(Number(h),this.heartbeatTimeout),0!==this.timeout)){f(this.timeout);var r=this;this.timeout=d(function(){r.onTimeout()},this.heartbeatTimeout)}}if(this.state===E){if(0!==this.dataBuffer.length){this.lastEventId=this.lastEventIdBuffer,""===this.eventTypeBuffer&&(this.eventTypeBuffer="message");var o=new a(this.eventTypeBuffer,{data:this.dataBuffer.join("\n"),lastEventId:this.lastEventIdBuffer});if(this.es.dispatchEvent(o),"message"===this.eventTypeBuffer&&b(this.es,this.es.onmessage,o),this.currentState===x)return}this.dataBuffer.length=0,this.eventTypeBuffer=""}this.state=s==="\r".charCodeAt(0)?3:E}else this.state===E&&(this.fieldStart=i,this.state=5),5===this.state?s===":".charCodeAt(0)&&(this.valueStart=i+1,this.state=6):6===this.state&&(this.state=7)}}},u.prototype.onFinish=function(){if(this.currentState===C||this.currentState===g){this.currentState=S,0!==this.timeout&&(f(this.timeout),this.timeout=0),this.retry>16*this.initialRetry&&(this.retry=16*this.initialRetry),this.retry>18e6&&(this.retry=18e6);var t=this;this.timeout=d(function(){t.onTimeout()},this.retry),this.retry=2*this.retry+1,this.readyState=g,this.es.readyState=g;var e=new r("error");this.es.dispatchEvent(e),b(this.es,this.es.onerror,e)}},u.prototype.onTimeout=function(){if(this.timeout=0,this.currentState===S){this.wasActivity=!1;var t=this;this.timeout=d(function(){t.onTimeout()},this.heartbeatTimeout),this.currentState=g,this.dataBuffer.length=0,this.eventTypeBuffer="",this.lastEventIdBuffer=this.lastEventId,this.fieldStart=0,this.valueStart=0,this.state=E;var e=this.url.slice(0,5);e="data:"!==e&&"blob:"!==e?this.url+(-1===this.url.indexOf("?",0)?"?":"&")+"lastEventId="+encodeURIComponent(this.lastEventId)+"&r="+(Math.random()+1).toString().slice(2):this.url;try{this.transport.open(e,this.withCredentials)}catch(i){throw this.close(),i}}else if(this.wasActivity){this.wasActivity=!1;var t=this;this.timeout=d(function(){t.onTimeout()},this.heartbeatTimeout)}else h(new Error("No activity within "+this.heartbeatTimeout+" milliseconds. Reconnecting.")),this.transport.cancel()},u.prototype.close=function(){this.currentState=x,this.transport.cancel(),0!==this.timeout&&(f(this.timeout),this.timeout=0),this.readyState=x,this.es.readyState=x},c.prototype=n.prototype,o.prototype=new c,o.prototype.close=function(){this._internal.close()},c.call(o),v&&(o.prototype.withCredentials=undefined);m!=undefined&&(t.EventSource==undefined||v&&!function(){return t.EventSource!=undefined&&"withCredentials"in t.EventSource.prototype}())&&(t.NativeEventSource=t.EventSource,t.EventSource=o)}("undefined"!=typeof window?window:this);