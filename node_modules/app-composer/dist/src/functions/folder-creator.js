"use strict";
const fs = require("fs");
const mkdirp2 = require("mkdirp");
function mkdirp(dir, opts, cb) {
    if (opts) {
        return mkdirp2(dir, opts, (err, made) => {
            if (err) {
                handleExistingError(err);
                return mkdirp2(dir, opts, cb);
            }
            else {
                cb(err, made);
            }
        });
    }
    else {
        return mkdirp2(dir, (err, made) => {
            if (err) {
                handleExistingError(err);
                return mkdirp2(dir, cb);
            }
            else {
                cb(err, made);
            }
        });
    }
}
function handleExistingError(e) {
    if (e.code === 'EEXIST') {
        console.log('path already exists ', e.path);
        const stats = fs.lstatSync(e.path);
        if (stats.isSymbolicLink()) {
            console.log('assuming link! try to unlink', e.path);
            fs.unlinkSync(e.path);
        }
        else {
            throw e;
        }
    }
}
(function (mkdirp) {
    function sync(dir, opts) {
        try {
            return mkdirp2.sync(dir, opts);
        }
        catch (e) {
            handleExistingError(e);
            return mkdirp2.sync(dir, opts);
        }
    }
    mkdirp.sync = sync;
})(mkdirp || (mkdirp = {}));
module.exports = mkdirp;
//# sourceMappingURL=folder-creator.js.map