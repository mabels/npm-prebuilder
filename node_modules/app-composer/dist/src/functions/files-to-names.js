"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const suffixes_1 = require("../types/suffixes");
const uuid = require("uuid");
function filesToNames(files) {
    const pkgs = new Map();
    const suffixs = new suffixes_1.Suffixes({
        package: 'suffixes',
        invocationJson: '.Invocation.json',
        npmPackage: '.npm.tgz'
    });
    files.forEach((fname) => {
        suffixs.values.forEach((suffix) => {
            if (!fname.endsWith(suffix)) {
                return;
            }
            const base = fname.slice(0, -suffix.length);
            const append = (pkgs.get(base) || []);
            append.push(fname);
            pkgs.set(base, append);
        });
    });
    Array.from(pkgs.entries()).forEach((e) => {
        if (e[1].length !== suffixs.values.length) {
            pkgs.delete(e[0]);
        }
    });
    const ret = new Map();
    pkgs.forEach((v, k) => {
        ret.set(k, {
            package: k,
            invocationJson: v.find((i) => i.endsWith(suffixs.names.invocationJson)),
            npmPackage: v.find((i) => i.endsWith(suffixs.names.npmPackage)),
            uuid: uuid.v4(),
        });
    });
    // console.log(`filesToNames:${JSON.stringify(Array.from(ret.values()))}`);
    return ret;
}
exports.filesToNames = filesToNames;
//# sourceMappingURL=files-to-names.js.map